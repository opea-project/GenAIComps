# Copyright (C) 2024 Intel Corporation
# SPDX-License-Identifier: Apache-2.0

include:
  - ../../../third_parties/whisper/deployment/docker_compose/compose.yaml
  - ../../../third_parties/funasr/deployment/docker_compose/compose.yaml

services:
  fireredasr-asr:
    image: ${REGISTRY:-opea}/asr:${TAG:-latest}
    container_name: fireredasr-asr-service
    ports:
      - ${ASR_PORT:-9099}:9099
    ipc: host
    environment:
      FIREREDASR_COMPONENT_NAME: ${FIREREDASR_COMPONENT_NAME:-OPEA_FIREREDASR_ASR}
      FIREREDASR_MODEL_DIR: ${FIREREDASR_MODEL_DIR:-/app/pretrained_models}
      FIREREDASR_ASR_TYPE: ${FIREREDASR_ASR_TYPE:-llm}
      ENABLE_MCP: ${ENABLE_MCP:-False}
      LOGFLAG: ${LOGFLAG:-true}
    volumes:
      - ${FIREREDASR_MODEL_DIR:-./models}:/app/pretrained_models:ro
    depends_on:
      - fireredasr-model-preparation
    networks:
      - opea-network

  fireredasr-model-preparation:
    image: ${REGISTRY:-opea}/fireredasr-model-preparation:${TAG:-latest}
    container_name: fireredasr-model-preparation-service
    environment:
      ASR_COMPONENT_NAME: ${ASR_COMPONENT_NAME:-OPEA_WHISPER_ASR}
      ENABLE_MCP: ${ENABLE_MCP:-False}
    depends_on:
      whisper-gaudi-service:
        condition: service_healthy
  asr-funasr-paraformer:
    extends: asr
    container_name: asr-funasr-paraformer-service
    environment:
      ASR_COMPONENT_NAME: ${ASR_COMPONENT_NAME:-OPEA_PARAFORMER_ASR}
      ENABLE_MCP: ${ENABLE_MCP:-False}
    depends_on:
      funasr-paraformer-service:
        condition: service_healthy

networks:
  opea-network:
    driver: bridge
