# Retriever Microservice

This retriever microservice is a highly efficient search service designed for handling and retrieving embedding vectors. It operates by receiving an embedding vector as input and conducting a similarity search against vectors stored in a vectordb database. Users must specify the vectordb's URL and the index name, and the service searches within that index to find documents with the highest similarity to the input vector.

The service primarily utilizes measures of similarity in vector space to rapidly retrieve documents that are contentually similar. This vector-based retrieval approach is particularly suited for handling large datasets, offering fast and accurate search results that significantly enhance the efficiency and quality of information retrieval.

Overall, this microservice provides robust backend support for applications requiring efficient similarity searches, playing a vital role in scenarios such as recommendation systems, information retrieval, or any other context where precise measurement of document similarity is crucial.

# ðŸš€Start Microservice with Python

To start the retriever microservice, you need to install python packages first.

## Install Requirements

```bash
pip install -r requirements.txt
```

## Setup Vectordb Service

You need to setup your own vectordb service (Redis in this example), and ingest your knowledge documents into the vector database.

As for Redis, you could start a docker container using the following commands. Remember to ingest data into it manually.

```bash
docker run -d --name="redis-vector-db" -p 6379:6379 -p 8001:8001 redis/redis-stack:7.2.0-v9
```

## Setup Environment Variables

```bash
export REDIS_URL="redis://${your_ip}:6379"
export INDEX_NAME=${your_index_name}
export TEI_EMBEDDING_ENDPOINT=${your_embedding_endpoint}
```

## Start Retriever Service with Local Model

```bash
python langchain/retriever_redis.py
```

# ðŸš€Start Microservice with Docker

## Build Docker Image

```bash
cd ../../
docker build -t opea/gen-ai-comps:retriever-redis-server --build-arg https_proxy=$https_proxy --build-arg http_proxy=$http_proxy -f comps/retrievers/langchain/docker/Dockerfile .
```

## Run Docker with CLI

```bash
docker run -d --name="retriever-redis-server" -p 7000:7000 --ipc=host -e http_proxy=$http_proxy -e https_proxy=$https_proxy -e REDIS_URL=$REDIS_URL -e INDEX_NAME=$INDEX_NAME opea/gen-ai-comps:retriever-redis-server
```

## Run Docker with Docker Compose

```bash
cd langchain/docker
docker compose -f docker_compose_retriever.yaml up -d
```

# ðŸš€Consume Retriever Service

## Check Service Status

```bash
curl http://localhost:7000/v1/health_check\
  -X GET \
  -H 'Content-Type: application/json'
```

## Consume Embedding Service

```bash
curl http://${your_ip}:7000/v1/retrieval\
  -X POST \
  -d '{"text":"What is the revenue of Nike in 2024?","embedding":[0.010203498415648937, -0.014632517471909523, -0.0213127750903368, 0.014020970091223717, 0.03371085226535797, 0.013330486603081226, 0.05332589149475098, 0.009495058096945286, -0.002751836320385337, 0.015090345405042171, -0.041899193078279495, -0.032830096781253815, -0.05883831903338432, 0.01832689717411995, 0.02110658958554268, 0.055592142045497894, 0.030790716409683228, -0.0019927211105823517, 0.07156679034233093, -0.003953069448471069, -0.051721785217523575, -0.007643045391887426, 0.02332385443150997, -0.022668715566396713, 0.033263497054576874, -0.00747459102421999, 0.04414736479520798, 0.03505362570285797, -0.0648355707526207, -0.014043589122593403, 0.04422762244939804, -0.001727710710838437, -0.007983513176441193, -0.0003432858793530613, 0.007535080425441265, 0.0491160973906517, -0.005241576582193375, 0.003726333612576127, -0.003076413879171014, -0.043252069503068924, -0.03838363662362099, -0.01215735636651516, -0.03173227980732918, -0.03704454377293587, -0.031705860048532486, -0.027589868754148483, 0.006944179069250822, 0.001684120623394847, -0.02756447158753872, -0.017721669748425484, -0.026952575892210007, 0.011639930307865143, -0.08231748640537262, 0.011170953512191772, -0.01590397208929062, 0.02828383259475231, 0.0279800184071064, -0.04844380170106888, -0.04299157112836838, -0.06778637319803238, 0.10387729108333588, 0.007047339342534542, -0.061225343495607376, -0.013387381099164486, 0.010438287630677223, -0.04682406038045883, 0.005516931880265474, 0.017471320927143097, -0.010491399094462395, -0.04901977628469467, -0.02396581321954727, 0.016188515350222588, -0.013037145137786865, 5.3368439694168046e-05, 0.05291997268795967, -0.02687094360589981, -0.02919718250632286, 0.01554262638092041, 0.004684212617576122, -0.00932433269917965, 0.026110323145985603, -0.007714763283729553, 0.022132886573672295, 0.04548659920692444, -0.0752001702785492, -0.04240899905562401, 0.027081916108727455, -0.011718781664967537, 0.00539694307371974, 0.0881604254245758, 0.04832421988248825, -0.015529649332165718, 0.04687086492776871, 0.02635555900633335, -0.04145161062479019, 0.01901433616876602, -0.021712230518460274, -0.008675871416926384, 0.0173871461302042, 0.012440593913197517, -0.005897384136915207, -0.019391648471355438, -0.04050920903682709, -0.08320844918489456, -0.04835253581404686, 0.025095775723457336, -0.02712906152009964, -0.03203585743904114, 0.058873556554317474, -0.007173708640038967, -0.033272940665483475, 0.02695544622838497, 0.020818063989281654, 0.02897087298333645, -0.04184724763035774, 0.060715194791555405, -0.0006536180735565722, 0.001708904397673905, -0.033257365226745605, 0.04300377890467644, -0.012168441899120808, -0.04087759181857109, -0.005298522301018238, 0.04302734509110451, -0.0038351186085492373, 0.014306719414889812, -0.022093476727604866, 0.014109766110777855, 0.0036422323901206255, -0.02226937748491764, -0.0075387959368526936, -0.03399225324392319, -0.042411040514707565, 0.0017435462214052677, 0.017126480117440224, -0.05401500687003136, -0.051905129104852676, 0.01247022021561861, 0.08964455127716064, 0.053278788924217224, 0.03844045102596283, -0.003684332827106118, 0.003595031099393964, 0.004125728737562895, 0.08051128685474396, 0.002810252597555518, 0.027988675981760025, 0.0033818238880485296, -0.04513668641448021, 0.07404166460037231, -0.027796121314167976, -0.01686749793589115, 0.01898011937737465, -0.05444784089922905, 0.03889647498726845, 0.05011971667408943, 0.04150162264704704, 0.015271049924194813, -0.045616425573825836, 0.023978304117918015, 0.04292815551161766, -0.015674076974391937, 0.0006428301567211747, -0.03052770532667637, -0.029148217290639877, 0.07582823932170868, 0.027441268786787987, -0.004112790338695049, -0.039888713508844376, -0.07035719603300095, -0.0014266128418967128, -0.06484456360340118, 0.034349020570516586, -0.054964836686849594, -0.04348278418183327, 0.004976833704859018, 0.04643530398607254, -0.04472173750400543, 0.0021185348741710186, 0.05166205018758774, -0.07420679926872253, 0.022072808817029, 0.06823959201574326, 0.03676220029592514, 0.033756934106349945, -0.04143228381872177, 0.07848380506038666, 0.018330786377191544, 0.02560489997267723, -0.01273568905889988, -0.014244294725358486, -0.05011310428380966, -0.05080532655119896, 0.019671481102705002, 0.020628325641155243, -0.031237535178661346, 0.02275875210762024, -0.01754237525165081, -0.020967179909348488, -0.010352210141718388, -0.011241552419960499, -0.0043573565781116486, 0.04075730964541435, -0.014618143439292908, -0.03832284361124039, 0.0347902812063694, 0.07034021615982056, -0.051376041024923325, -0.03555421158671379, 0.007150918245315552, -0.01273760013282299, -0.037735361605882645, 0.008394643664360046, -0.0585901215672493, -0.005693839397281408, -0.03262651339173317, -0.014180805534124374, 0.021494366228580475, -0.022877002134919167, -0.009553547017276287, 0.03948111832141876, 0.021701321005821228, -0.014449608512222767, -0.005770309362560511, -0.014020591974258423, 0.06905504316091537, -0.017394086346030235, -0.036855533719062805, -0.03167343512177467, -0.01266319490969181, 0.020535362884402275, 0.008785644546151161, -0.0074060168117284775, -0.046504680067300797, 0.016889048740267754, 0.00942368432879448, -0.0285955723375082, -0.019113905727863312, 0.04287397488951683, 0.00022339467250276357, -0.018997490406036377, 0.07073827087879181, -0.015224103815853596, 0.01781291514635086, 0.005484236404299736, -0.010603013448417187, 0.019909203052520752, -0.002889420138671994, 0.05166492983698845, -0.05341111496090889, 0.04390803351998329, 0.034449558705091476, -0.02660381980240345, -0.004727150779217482, -0.006877273321151733, 0.009603504091501236, 0.004765113815665245, 0.026137014850974083, 0.06365253776311874, 0.012566114775836468, 0.024570902809500694, -0.01638982631266117, 0.061182901263237, 0.04771600291132927, -0.038641225546598434, -0.062323130667209625, -0.05959624797105789, 0.004232855048030615, 0.02292114496231079, -0.06942172348499298, 0.05153335630893707, 0.0026979069225490093, 0.007306070998311043, 0.005662824027240276, -0.009327358566224575, 0.02384931780397892, 0.009155971929430962, 0.0011182775488123298, -0.015679432079195976, 0.02352900616824627, 0.04159655049443245, 0.04107459634542465, 0.004654718097299337, -0.015865465626120567, -0.010554005391895771, -0.09866839647293091, 0.018681185320019722, 0.03449907526373863, 0.02226768247783184, 0.022573430091142654, -0.04076042398810387, 0.06848206371068954, -0.004832332953810692, 0.06770866364240646, 0.04507237672805786, 0.0167117677628994, -0.03740104287862778, -0.0010870866244658828, -0.06650642305612564, 0.03727574646472931, -0.0874442309141159, -0.018023179844021797, -0.02737238071858883, 0.01812870055437088, 0.036630287766456604, -0.007123250048607588, 0.010508034378290176, -0.036877069622278214, -0.16485820710659027, 0.0010165575658902526, -0.02756083384156227, 0.007282040547579527, 0.03718144819140434, -0.024707652628421783, -0.0075053866021335125, 0.007612739689648151, -0.013310552574694157, 0.04726973921060562, 0.017735175788402557, -0.028450416401028633, -0.020531071349978447, 0.04322270303964615, 0.038729578256607056, -0.014432444237172604, 0.055318862199783325, 0.010877402499318123, 0.010183661244809628, -0.0360088124871254, 0.030579490587115288, -0.0712701678276062, -0.0005711474805139005, 0.01476916391402483, 0.0251451525837183, 0.06776291877031326, -0.054714519530534744, -0.04027178883552551, -0.01672845520079136, 0.015832291916012764, 0.025678155943751335, -0.030266031622886658, 0.03751668334007263, 0.06441713869571686, -0.017672987654805183, -0.030258920043706894, -0.03679422289133072, -0.0013613882474601269, -0.018175706267356873, -0.03419039770960808, -0.01076610665768385, -0.033969946205616, -0.07270513474941254, 0.021104682236909866, 0.0431387759745121, 0.07694410532712936, -0.07529648393392563, -0.004843017552047968, -0.03843783959746361, 0.05214826762676239, 0.029790667816996574, -0.06371714174747467, -0.055148523300886154, -0.01946651190519333, -0.005282060708850622, -0.014655960723757744, 0.02136738784611225, 0.014761628583073616, 0.005180781707167625, 0.03495657444000244, -0.006055671721696854, 0.021751223132014275, -0.029894381761550903, -0.024617452174425125, -0.025095295161008835, -0.04691643640398979, -0.012869863770902157, -0.016581591218709946, 0.0472089946269989, -0.01289595291018486, -0.03113689459860325, -0.018748987466096878, -0.046564675867557526, -0.04612746089696884, -0.004424059763550758, -0.021796125918626785, 0.03693180903792381, 0.050417911261320114, 0.02795504406094551, -0.015025860629975796, -0.02003931626677513, -0.06008760258555412, 0.007524500135332346, 0.06137809157371521, 0.01255672238767147, -0.0490807369351387, 0.028468511998653412, -0.012413708493113518, -0.007588782347738743, 0.03702728822827339, 0.03786718100309372, -0.0464865006506443, -0.023622481152415276, -0.007803944870829582, 0.030102470889687538, 0.015120919793844223, -0.005158699117600918, -0.02982964739203453, -0.038660865277051926, 0.026427797973155975, -0.01051296852529049, -0.0318840853869915, -0.06431851536035538, -0.048442158848047256, -0.03712788224220276, -0.013399606570601463, -0.0023664908949285746, -0.01890469714999199, 0.052517566829919815, -0.04668110981583595, 0.07487798482179642, -0.03957090154290199, -0.02822887897491455, -0.02288617193698883, -0.04455341026186943, -0.036145519465208054, -0.005247597582638264, 0.02281847782433033, 0.019680138677358627, -0.0477796345949173, -0.021980680525302887, 0.00876926351338625, -0.05353991314768791, 0.00748735386878252, -0.04420095309615135, -0.002392122521996498, 0.0056465137749910355, 0.00016246014274656773, -0.009034446440637112, -0.04440251737833023, -0.0033711018040776253, 0.01431331317871809, -0.06517859548330307, -0.03832395374774933, 0.019634457305073738, -0.0024974881671369076, 0.05030202120542526, -0.06646326184272766, 0.00034773399238474667, -0.032190948724746704, -0.009172722697257996, 0.02761872671544552, 0.027612287551164627, 0.03650307282805443, 0.04579557478427887, 0.011175998486578465, 0.006849429104477167, -0.016867762431502342, -0.007297569885849953, 0.031547799706459045, 0.009709689766168594, 0.03588540479540825, -0.035281553864479065, -0.03588254749774933, -0.04583011940121651, -0.016923127695918083, 0.08562271296977997, -0.03150589391589165, 0.014985605143010616, -0.01355945598334074, 0.0274973027408123, 0.03425634652376175, -0.03846244513988495, 0.02099110558629036, -0.02532019466161728, 0.01230975054204464, 0.03242340683937073, 0.0334269218146801, 0.006978118326514959, 0.018435895442962646, 0.002350673545151949, -0.08556575328111649, -0.0025111259892582893, -0.017462192103266716, -0.0137476259842515, 0.050405047833919525, 0.031203938648104668, 0.01023450493812561, 0.016362816095352173, 0.027948467060923576, -0.02594662830233574, -0.020045116543769836, -0.030842002481222153, 0.014215073548257351, 0.017837608233094215, 0.0017556357197463512, -0.05065666884183884, -0.0005760564818046987, 0.01228091400116682, 0.0004588392039295286, -0.013145237229764462, 0.041155699640512466, -0.03061981312930584, -0.021107662469148636, -0.01322956196963787, -0.07343021035194397, 0.02333262376487255, 0.0869637280702591, -0.04590427130460739, 0.051186103373765945, 0.0012834020890295506, -0.04847138002514839, 0.007918746210634708, -0.007082570344209671, 0.040228527039289474, -0.021795347332954407, -0.029548201709985733, 0.004286391660571098, 0.07707380503416061, 0.025586746633052826, -0.04763394594192505, 0.012228908017277718, 0.024453239515423775, 0.006888742092996836, -0.009053129702806473, -0.008339357562363148, 0.005145648960024118, 0.032028935849666595, -0.037545621395111084, 0.011158850975334644, 0.05424739420413971, -0.03437924385070801, 0.01119622215628624, -0.020169425755739212, -0.003462180495262146, 0.05363074690103531, 0.006739205215126276, 0.013587312772870064, -0.08591575920581818, -0.04878589138388634, 0.043637923896312714, -0.06529238075017929, -0.001713743433356285, -0.0029935964848846197, -0.01623677834868431, 0.029940595850348473, -0.04273587465286255, 0.04199446737766266, -0.027747174724936485, -0.01289130188524723, -0.07786471396684647, -0.036801908165216446, -0.019182592630386353, -0.04739432781934738, -0.01626976579427719, 0.01283861044794321, -0.03953860327601433, 0.0446699783205986, 0.0547085702419281, 0.022201552987098694, -0.023685617372393608, 0.03598645702004433, -0.03851496800780296, -0.0033617776352912188, 0.06860169023275375, -0.03324039280414581, -0.040440306067466736, 0.01429513469338417, -0.049509402364492416, -0.01915230043232441, -0.019686682149767876, 0.02894647791981697, -0.030007993802428246, 0.07261178642511368, 0.02919958531856537, 0.07382102310657501, -0.026641011238098145, -0.02638561651110649, 0.058400463312864304, 0.02247435599565506, -0.0061726039275527, -0.06795533001422882, -0.010439588688313961, 0.01152474619448185, 0.04206343740224838, -0.030319521203637123, 0.0037086112424731255, -0.0279585812240839, 0.0017831642180681229, -0.0396527424454689, -0.035153020173311234, -0.01949559524655342, -0.047040700912475586, 0.03426079824566841, 0.06617379188537598, -0.03601863235235214, 0.010257754474878311, 0.02378655970096588, -0.03809687867760658, -0.02038281410932541, -0.03591102361679077, 0.021403193473815918, 0.02881379798054695, 0.01828862354159355, -0.07109742611646652, -0.01483782660216093, 0.0667714774608612, -0.0037873846013098955, -0.0036421010736376047, 0.054659318178892136, 0.0036851423792541027, -0.003992717247456312, 0.0023840079084038734, 0.009042548947036266, -0.0067183393985033035, 0.029419125989079475, -0.0025360058061778545, -0.04033360257744789, -0.0266267042607069, -0.01749303750693798, 0.018258554860949516, -0.049983516335487366, 0.11405608057975769, -0.0021730985026806593, -0.02690524235367775, 0.023216497153043747, -0.017997708171606064, 0.005465296562761068, 0.009350335225462914, -0.0023395298048853874, -0.015426794067025185, -0.04639057815074921, 0.042975932359695435, 0.01751372031867504, 0.039159610867500305, -0.013631136156618595, 0.033416394144296646, 0.048933714628219604, 0.013408944010734558, 0.0180701594799757, 0.01413890440016985, -0.018378645181655884, -0.02993294782936573, 0.06663182377815247, 0.0012384852161630988, -0.02978542260825634, -0.04794029891490936, -0.04521656781435013, -0.01843021996319294, 0.04667641595005989, 0.0017542671412229538, 0.022625546902418137, 0.03812144324183464, -0.005115796811878681, -0.01683671586215496, -0.0489378459751606, -0.0025495674926787615, -0.030285527929663658, 0.07774221152067184, 0.06655830144882202, -0.004344393964856863, 0.04907137155532837, -0.03923127427697182, 0.047425463795661926, -0.002731568180024624, 0.008863057009875774, 0.006403680425137281, 0.027603326365351677, 0.014169499278068542, 0.0029889887664467096, -0.02417457103729248, 0.019485102966427803, 0.06358988583087921, -0.00945315696299076, 0.004496131557971239, -0.027998317033052444, -0.04246479645371437, 0.047656867653131485, 0.042822644114494324, 0.026091182604432106, -0.008123178966343403, -0.005820250604301691, 0.013022128492593765, 0.017633378505706787, 0.031142432242631912, 0.023283302783966064, -0.044957466423511505, -0.023678764700889587, 0.01128749642521143, 0.0453246533870697, 0.018824081867933273, -0.017629561945796013, -0.02001059800386429, -0.003227471373975277, -0.03795481100678444, -0.011160088703036308, -0.0003565177321434021, 0.03174220025539398, 0.0030678128823637962, -0.029341310262680054, -0.019389573484659195, -0.020321423187851906, -0.02068893052637577, 0.029956243932247162, -0.01084150467067957, 0.014290695078670979, 0.038043104112148285, -0.013924198225140572, -0.028718478977680206, 0.03548504412174225, 0.077885203063488, 0.0010972230229526758, -0.044314801692962646, 0.058638278394937515, 0.07158134132623672, -0.0008808704442344606, 0.04664391651749611, 0.00432950584217906, -0.06169980764389038, -0.038811761885881424, 0.03967195376753807, -0.0038554631173610687, -0.058056145906448364, 0.05665029212832451, 0.02160787023603916, 0.028384152799844742, 0.0009089250233955681, 0.015337707474827766, -0.014276629313826561, -0.026239478960633278, -0.031042056158185005, 0.006231495179235935, -0.07357431948184967, 0.04911743476986885, -0.024312563240528107, 0.0606597401201725, 0.05325718969106674, -0.000286440656054765, 0.030237611383199692, 0.023308493196964264, -0.052097540348768234, 0.0351734384894371, -0.07770765572786331, 0.003814653493463993, -0.02515365742146969, -0.08109854906797409, -0.023830682039260864, -0.017031600698828697, -0.055326931178569794, -0.05755174905061722, -0.015014336444437504, 0.06400032341480255, 0.08602907508611679, 0.00030159682501107454, 0.002767192665487528, -0.01025472953915596, 0.007203667890280485, -0.020926503464579582, 0.011931737884879112, 0.0313413180410862, -0.01673264615237713, 0.03182464465498924, 0.06345915049314499, -0.023525787517428398, 0.03719904273748398, -0.023867402225732803, 0.004492145497351885, 0.009164589457213879, -0.01304305624216795, -0.05286748334765434]}' \
  -H 'Content-Type: application/json'
```
